<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=, initial-scale=1.0">
  <title>Document</title>

  <link rel="stylesheet" href="https://cdn.metroui.org.ua/v4.3.2/css/metro-all.min.css">
  <link href="metro-icons.css" rel="stylesheet">
</head>

<style>
    *
{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: consolas;
}

  p {
    background-color: black;
    padding: 10px;
  }

  img {
    border: 1px solid black;
  }

  form {
    padding-top: 10px;
  }

  #searchInfo {
    width: 300px;
    text-align: center;
  }
  .container {
    background-color: black;
  } 
  
  /* .text-center {
    align-text: center;
  }
   */
  .align {
    display: inline;
  }

  .navview-content {
    background-image: url('/assets/Background\ Img.jpg');
    background-color: gray;
    color: white;
    padding: 10px;
    height: 1000px;
  }


  
  </style>


  <div data-role="navview">
<div data-role="navview">
  <div class="navview-pane">
    <button class="pull-button">
      <span class="default-icon-menu"></span>
    </button>

    <ul class="navview-menu">
      <li class="item-header">Main pages</li>

      <li>
        <a href="./api.html">
          <span class="icon"><span class="mif-search"></span></span>
          <span class="caption">Search Anime</span>
        </a>

            <!-- <div class="suggest-box">
              <input type="text" data-role="input" data-clear-button="false"  name="search" id="searchInfo" placeholder="Search Anime...">
              <button id="search" class="button primary">
                <span class="mif-search">Search</span>
              </button>
            </div> -->
      </li>
      <li>
        <a href="./saved.html">
          <span class="icon"><span class="mif-list"></span></span>
          <span class="caption">Your Anime List</span>
        </a>
      </li>
      <li>
        <a href="./creators.html">
          <span class="icon"><span class="mif-user"></span></span>
          <span class="caption">Creators</span>
        </a>
      </li>
      <li>
        <a href="./index.html">
          <span class="icon"><span class="mif-cross"></span></span>
          <span class="caption">Sign Out</span>
        </a>
      </li>
    </ul>

  </div>

  <div class="navview-content">
        <div class="container">
          <h1>ANIME SEARCH</h1>
        </div>
        <div class="container">
              <form>
          <input type="text" name="search" id="searchInfo" placeholder="Search Anime...">
          <button id="search" class="button primary align">Search</button>
        </form>
        </div>

  <div class="container">
    <div class="row" id="results"></div>
    <div id="more"></div>
  </div>
  </div>

  </div>


  <script src="https://cdn.metroui.org.ua/v4.3.2/js/metro.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

      // click even for searching anime
      document.getElementById(`search`).addEventListener(`click`, event => {
        event.preventDefault()
        const searchInfo = document.getElementById(`searchInfo`).value

        // removes previous search from innerHTML 
        document.getElementById('results').innerHTML = ''
        document.getElementById('more').innerHTML = ''

        // adds more results button after first search (currently only using 10 results)
        let moreResults = document.createElement('button');
        moreResults.classList = "btn btn-primary";
        moreResults.innerHTML = "More Results";

        document.getElementById('more').append(moreResults)


        // get request for anime
        axios.get(` https://api.jikan.moe/v3/search/anime?q=${searchInfo}&page=1`)
          .then(res => {
            console.log(res.data)
            const search = res.data.results
            console.log(search)
            for (let searchIndex = 0; searchIndex < 5; searchIndex++) {
              let searchResults = search[searchIndex];
              let searchId = searchResults.mal_id
              let searchURL = searchResults.image_url;
              let searchElem = document.createElement('div');
              searchElem.classList = "col";

              // what is going to be appended on the page from API information
              searchElem.innerHTML =
                `
            <h2>${searchResults.title}</h2>
            <img  src='${searchURL}' alt='${searchResults.title}' style="width:75%;">
              <h4>Rating: ${searchResults.score}</h4>
                  <p><strong>Synopsis: </strong> ${searchResults.synopsis}</p>
                  <button class ="save mif-plus button secondary" data-index="${searchId}"> Add To List</button>
                  `;

              // click even to save and push to database using ID/data-index
              document.addEventListener('click', event => {
                const index = parseInt(event.target.dataset.index)
                if (event.target.className === 'save btn-btn-primary' & index === searchId) {

                  console.log(searchResults)
                  const anime = {
                    title: `${searchResults.title}`,
                    image: `${searchURL}`,
                    rating: `${searchResults.score}`,
                    synopsis: `${searchResults.synopsis}`
                  }
                  console.log(anime)
                  // console.log(anime)
                  // axios.post('/api/giphy', anime)
                  // .then(() => console.log(`anime saved`))
                  // .catch(err => console.log(err))
                  // event.target.parentNode.style.display = "none";
                }
              });


              document.getElementById(`results`).append(searchElem)

            }


            // get request for second anime search (same as above)
            document.getElementById('more').addEventListener('click', event => {
              document.getElementById('results').innerHTML = ''
              document.getElementById('more').innerHTML = ''
              for (let searchIndex = 6; searchIndex < 11; searchIndex++) {
                let searchResults = search[searchIndex];

                let searchURL = searchResults.image_url;
                let searchElem2 = document.createElement('div');
                searchElem2.classList = "col";


                searchElem2.innerHTML =
                  `
                  <h2>${searchResults.title}</h2><img src='${searchURL}' alt='${searchResults.title}' style="width:75%;">
                  <h4>Score: ${searchResults.score}</h4>
                  <p>Synopsis: ${searchResults.synopsis}</p>
                  <button class ="btn btn-primary">"Add to my List"</button>
                  `;


                document.addEventListener('click', event => {
                  const index = parseInt(event.target.dataset.index)
                  if (event.target.className === 'save btn-btn-primary' & index === searchId) {

                    console.log(searchResults)
                    const anime = {
                      title: `${searchResults.title}`,
                      image: `${searchURL}`,
                      rating: `${searchResults.score}`,
                      synopsis: `${searchResults.synopsis}`
                    }
                    console.log(anime)
                    // console.log(anime)
                    // axios.post('/api/giphy', anime)
                    // .then(() => console.log(`anime saved`))
                    // .catch(err => console.log(err))
                    // event.target.parentNode.style.display = "none";
                  }
                });

                document.getElementById(`results`).append(searchElem2)

              }
            })

          })
          .catch(err => console.log(err))
      })

    </script>
</body>

</html>